<!DOCTYPE html><html prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta property="og:title" content="Geo queries, finding squares inside a bounding box"><meta property="og:type" content="article"><meta property="og:url" content="http://www.danielbeeke.nl/geo-queries/"><meta property="og:image" content="http://www.danielbeeke.nl/img/geo.18e3.jpg"><meta property="og:description" content="For one of our websites we had to create a filter widget to search for squares inside a bounding box. You can find the resulting Drupal 8 module with a bounding box field type, a leaflet field widget and a views exposed filter widget at the bottom of this article.
"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="theme-color" content="#ffffff"><title>Geo queries, finding squares inside a bounding box</title><meta name="viewport" content="width=device-width"><script>!function(){"use strict";function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(e){return window.localStorage&&localStorage.font_css_cache&&localStorage.font_css_cache_file===e}function n(){if(window.localStorage&&window.XMLHttpRequest)if(t(o))c(localStorage.font_css_cache);else{var n=new XMLHttpRequest;n.open("GET",o,!0),e(n,"load",function(){4===n.readyState&&(c(n.responseText),localStorage.font_css_cache=n.responseText,localStorage.font_css_cache_file=o)}),n.send()}else{var a=document.createElement("link");a.href=o,a.rel="stylesheet",a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a),document.cookie="font_css_cache"}}function c(e){var t=document.createElement("style");t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)}var o="/fonts/fonts.css";window.localStorage&&localStorage.font_css_cache||document.cookie.indexOf("font_css_cache")>-1?n():e(window,"load",n)}();</script><link rel="stylesheet" href="/css/main.b7cd.css"><script src="/js/scripts.e102.js"></script></head><body class="geo-queries"><div class="page-wrapper"><style type="text/css">.post-content h1, h2, h3, h4, h5, h6 {
    color: #013983;
  }</style><a class="hamburger-menu" href="/"><div class="bar"></div><div class="bar"></div><div class="bar"></div></a><div class="post transition-in"><header class="post-header"><h1 class="post-title">Geo queries, finding squares inside a bounding box</h1><p class="post-meta">Jul 18, 2015</p></header><article class="post-content"><div class="post-image" style="background-image: url(/img/geo.18e3.jpg)"></div><p>For one of our websites we had to create a filter widget to search for squares inside a bounding box. You can find the resulting Drupal 8 module with a bounding box field type, a leaflet field widget and a views exposed filter widget at the bottom of this article.</p><p>While starting and thinking about this filter, we thought it would be simple to create the widget, we thought we had it all figured out. In the following image you can see how we thought about it. The idea was simple, we must create two sql expressions, one with the percentage of the overlap of the filter on the article, and one with the percentage of the overlap of the article on the filter. Than we could sort and grab a beer. But it went different. Seems we aren&#39;t that good in math.</p><p><img src="/img/search.4dee.png"></p><p>We (my colleague and I) found it difficult to work with latitudes and longitudes, where some could be negative and others positive. I you know the math, please respond.</p><p><img src="/img/2880986675.b9eb.gif" class="right"></p><p>We finnished the logic in a different wy, we first query on all the things that are inside the filters, than the things that are partly in the filter, and than, all the things that include the filter bounding box.</p><p><a href="https://github.com/studio-fonkel/bbox" target="_blank">Here you can download the module</a>. The module is a work in progress, is it on your own risk.</p><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'danielbeeke';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script></article><div class="post-left"><div class="site-author"><a href="/about-me" class="about-me-link"><h1><span class="author-image" style="background-image: url('/img/me.63c2.jpg')"></span><span class="name">Daniel Beeke</span></h1><p>A programmer with a thirst for inventions. Loving music and creating things.</p></a></div><span class="post-tags-wrapper"><a href="/#geo" class="tag" style="background-color: #013983">geo</a> <a href="/#development" class="tag" style="background-color: #013983">development</a></span></div></div></div></body></html>