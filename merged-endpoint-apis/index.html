<!DOCTYPE html><html prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta property="og:title" content="Merged endpoint API's"><meta property="og:type" content="article"><meta property="og:url" content="http://www.danielbeeke.nl/merged-endpoint-apis/"><meta property="og:image" content="http://www.danielbeeke.nl/img/apis.116b.jpg"><meta property="og:description" content="How to create an API that is performant for mobile devices? That is a question that is bugging me for a while.
"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="theme-color" content="#ffffff"><title>Merged endpoint API's</title><meta name="viewport" content="width=device-width"><script>!function(){"use strict";function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(e){return window.localStorage&&localStorage.font_css_cache&&localStorage.font_css_cache_file===e}function n(){if(window.localStorage&&window.XMLHttpRequest)if(t(o))c(localStorage.font_css_cache);else{var n=new XMLHttpRequest;n.open("GET",o,!0),e(n,"load",function(){4===n.readyState&&(c(n.responseText),localStorage.font_css_cache=n.responseText,localStorage.font_css_cache_file=o)}),n.send()}else{var a=document.createElement("link");a.href=o,a.rel="stylesheet",a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a),document.cookie="font_css_cache"}}function c(e){var t=document.createElement("style");t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)}var o="/fonts/fonts.css";window.localStorage&&localStorage.font_css_cache||document.cookie.indexOf("font_css_cache")>-1?n():e(window,"load",n)}();</script><link rel="stylesheet" href="/css/main.af3a.css"><script src="/js/scripts.cd48.js"></script></head><body class="merged-endpoint-apis"><style type="text/css">.post-content h1, h2, h3, h4, h5, h6 {
    color: #c9ac37;
  }</style><a class="hamburger-menu" href="/"><div class="bar"></div><div class="bar"></div><div class="bar"></div></a><div class="post transition-in"><header class="post-header"><h1 class="post-title">Merged endpoint API's</h1><p class="post-meta">May 21, 2015</p></header><article class="post-content"><div class="post-image" style="background-image: url(/img/apis.116b.jpg)"></div><p>How to create an API that is performant for mobile devices? That is a question that is bugging me for a while.</p><p>I think tools like Drupal, or angular are on a good road, but not for mobile apps. Hitting the server 20 times for 10 seconds of using an app, doesn&#39;t seem such a good idea to me.</p><p>I have been thinking about merged endpoints. I will explain it with an example of the app that has made me think about it. A travel blog. Suppose we have a SAAS travel blog, everyone can create a blog, and a blog is located at johndoe.travelblog.cool. Let&#39;s say that we are creating the frontend plain javascript with the help of (a lot) libaries.</p><p>When traveling in the jungle or desert, it would be great if you could still write your blog, and when there is a little, very little of access to the internet available, it would be great if your blog would be posted, and if you could view the comments that are posted on it.</p><p>Server trips are expensive, just like world trips. It would be better to serve all the stuff in one single request. See <a href="http://stackoverflow.com/questions/3138371/very-large-http-request-vs-many-small-requests">http://stackoverflow.com/questions/3138371/very-large-http-request-vs-many-small-requests</a>, other people are having the same thoughts. I don&#39;t know for sure if a single request is better, but for this idea let&#39;s go with it.</p><p>What if we could serve multiple traditional REST API endpoints through a merged endpoint. For example we have the following endpoints: user, journey, comment, location and photo. What if we would have something like merged/journey/{slug} which would give all the objects that we need for that specified slug. So calling that endpoint would return photo&#39;s, locations, comments, users, and the journey.</p><p>Okay, so we could have one endpoint for getting all the data needed for one page view in the app. Hooray! Now caching becomes a challenge. Let&#39;s say we are using localstorage, session storage or no storage as cache mechanism. Every device requests the merged endpoint every time that it wants to display a certain route. The device sends along a cache token (got that one from the first request) and recieves all the data. If the device is incapable of local/session storage, the token get&#39;s lost all the time (no storage) and the data is requested over and over again, it&#39;s working for old devices, yess.</p><p>Now the newer devices, how we do that? The device sends the token along with the request, the server checks if it knows the token, en sees what objects were send. It checks the timestamp of the last update of the cache token object, which holds all the id&#39;s that were sent over the line, it checks all those objects, specifically their update time and returns all the new or updated objects along with delete requests for removed items.</p><p>So while visiting the blog of John Doe, the first time the device requests merged/journey/john-doe-in-china en recieves all the objects, locally, the javascript stores the object in the local storage, and displays the page.</p><p>Next time you are visiting John Doe&#39;s page the request is done, the cache token is sent along, and only the new objects or the updated objects, or the removed object id&#39;s are send in the response.</p><p>When implementing this idea, you could also base64 your images, or atleast your thumbnails, so the page loading will be very fast when the data is arrived. I think this would serve good for an app or a website where you have a throbber.</p><p>I want to create this for Drupal 8, I have a prototype working in Drupal 7. What are you thinking about such a system? Do you see downfalls? Or other ideas?</p><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'danielbeeke';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script></article><div class="post-left"><div class="site-author"><a href="/about-me" class="about-me-link"><h1><span class="author-image" style="background-image: url('/img/me.dc93.jpg')"></span><span class="name">Daniel Beeke</span></h1><p>A programmer with a thirst for inventions. Loving music and creating things. <span class="fake-link">More about me Â»</span></p></a></div><span class="post-tags-wrapper"><a href="/#development" class="tag" style="background-color: #c9ac37">development</a> <a href="/#api" class="tag" style="background-color: #c9ac37">api</a></span></div></div></body></html>